% Beamer theme for Free-Electrons presentations
% Copyright (C) 2010 Maxime Petazzoni <maxime.petazzoni@bulix.org>
% Creative Commons CC-by-sa 3.0

\usepackage[absolute,verbose,overlay]{textpos}
\usepackage{fancyvrb}
\setlength{\TPHorizModule}{\paperwidth}
\setlength{\TPVertModule}{\paperheight}

\usetheme{default}
\useinnertheme{default}
\useoutertheme{default}
\usecolortheme{seahorse}

% Define the "Free-Electrons blue" color
\definecolor{feblue}{rgb}{0.7980,0.7980,1.0}
\setbeamercolor*{palette primary}{bg=feblue}

\definecolor{fecode}{rgb}{0.5,0.5,0.5}
\setbeamercolor{code}{fg=fecode}

\definecolor{fecodebg}{rgb}{0.9,0.9,0.9}
\setbeamercolor{block body}{bg=fecodebg}

\setbeamertemplate{blocks}[rounded][shadow=false]

% Custom free-electrons commands
\newcommand{\code}[1]{{\usebeamercolor[fg]{code} \path{#1}}}
\newcommand\kfunc[1]{\href{http://lxr.free-electrons.com/ident?i=#1}{\code{#1()}}}
\newcommand\ksym[1]{\href{http://lxr.free-electrons.com/ident?i=#1}{\code{#1}}}
\newcommand\kstruct[1]{\href{http://lxr.free-electrons.com/ident?i=#1}{\code{struct #1}}}
\newcommand\kpath[1]{\href{http://lxr.free-electrons.com/source/#1}{\code{#1}}}
\newcommand\ksubarch[1]{\href{http://lxr.free-electrons.com/source/arch/#1}{\code{#1}}}
\newcommand\kerneldoc[1]{{\href{http://free-electrons.com/kerneldoc/latest/#1}{\code{Documentation/#1}}}
}

\usepackage{listings}
\usepackage{environ}
\usepackage{minted}
\usepackage{setspace}
\usepackage{etoolbox}

% Display straight quotes instead of curly ones in verbatim mode
\usepackage{upquote}

\lstloadlanguages{C}
\lstset{%
  basicstyle=\tiny \ttfamily,
  emphstyle=\color{blue}\bfseries\ttfamily,
}

\lstnewenvironment{codeblock}
 {\begin{block}{}}
 {\end{block}}

%% Mode presentation
\mode<presentation>

% Remove navigation symbols
\setbeamertemplate{navigation symbols}{}

\defbeamertemplate*{frametitle}{fetheme}
{
  \vskip-2pt
  \hbox{%
    \begin{beamercolorbox}[wd=\paperwidth,ht=3ex,dp=1.5ex]{frametitle}%
      \usebeamerfont{frametitle}
      \begin{textblock}{.2}[0.5,0.5](0.12,0.07)
       \includegraphics[width=1cm]{common/logo-penguins.pdf}
      \end{textblock}
      \hspace{1.25cm}
      \insertframetitle
    \end{beamercolorbox}
  }
}

% Footer
\defbeamertemplate*{footline}{fetheme}
{
  \hbox{%
    \begin{beamercolorbox}[wd=\paperwidth,ht=2.25ex,dp=1ex,leftskip=0.5em]{palette primary}%
      \Tiny
      \begin{tabular*}{\textwidth}{@{\extracolsep{\fill}} lr}
        Free Electrons - Embedded Linux, kernel, drivers and Android - Development, consulting, training and support.
        ~{\tt http://free-electrons.com} & \insertframenumber{}/\inserttotalframenumber{}
      \end{tabular*}
    \end{beamercolorbox}
  }
  \vskip0pt
}

\newcommand\tinyv{\@setfontsize\tinyv{4pt}{6}}

\newcommand{\@authors}{}
\newcommand{\authors}[1]
{
  \renewcommand{\@authors}{#1}
}

\newcommand{\@trainingurl}{}
\newcommand{\trainingurl}[1]
{
  \renewcommand{\@trainingurl}{#1}
}

\newcommand\titleframe[1]
{
  \begin{frame}{#1}
    \begin{columns}[b]
      \column{0.5\textwidth}
      \Large
      #1\\
      \vspace{0.5cm}
      \footnotesize
      {\bf \@authors}\\
      \vspace{1cm}
      \tinyv
      © Copyright 2004-\the\year, Free Electrons.\\
      Creative Commons BY-SA 3.0 license.\\
      Latest update: \today.\\
      Document updates and sources:\\
      \url{\@trainingurl}\\
      Corrections, suggestions, contributions and translations are welcome!
      \column{0.5\textwidth}
      \includegraphics[height=4cm]{common/logo-square.pdf}
    \end{columns}
  \end{frame}
}

\AtBeginSection[]
{
  \begin{frame}{\insertsectionhead}
    \begin{columns}[b]
      \column{0.5\textwidth}
      \huge
      \insertsection\\
      \vspace{0.5cm}
      \footnotesize
      {\bf \@authors}\\
      \vspace{1cm}
      \tinyv
      © Copyright 2004-\the\year, Free Electrons.\\
      Creative Commons BY-SA 3.0 license.\\
      Corrections, suggestions, contributions and translations are welcome!
      \column{0.5\textwidth}
      \includegraphics[height=4cm]{common/logo-square.pdf}
    \end{columns}
  \end{frame}
}

\AtBeginSubsection[]
{
  \begin{frame}{\insertsectionhead}
    \huge
    \begin{center}
      \insertsubsection
    \end{center}
  \end{frame}
}

%% Create a slide announcing a lab, with the beautiful worker penguin
%% on the left.
%%  first argument: slide title (will be prepended by 'Practical lab - ')
%%  second argument: contents of the slide
\newcommand\setuplabframe[2]{
  \begin{frame}{Practical lab - #1}
    \begin{columns}
      \column{0.4\textwidth}
      \includegraphics[width=\textwidth]{common/lab-penguin.png}
      \column{0.6\textwidth}
      #2
      \end{columns}
  \end{frame}
}

\newcommand\todo[1]{
  {\large \color{red}TODO: #1}
}

\usemintedstyle{perldoc}
